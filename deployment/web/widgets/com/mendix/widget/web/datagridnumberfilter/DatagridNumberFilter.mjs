import{Children as e,createElement as t,useEffect as l,useState as a,useCallback as r,useRef as n}from"react";import{createPortal as o}from"react-dom";import{Big as i}from"big.js";import{or as u,attribute as s,literal as c,greaterThan as d,greaterThanOrEqual as m,equals as v,notEqual as f,lessThan as p,lessThanOrEqual as b}from"mendix/filters/builders";var g,h={exports:{}};
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/g=h,function(){var e={}.hasOwnProperty;function t(){for(var l=[],a=0;a<arguments.length;a++){var r=arguments[a];if(r){var n=typeof r;if("string"===n||"number"===n)l.push(r);else if(Array.isArray(r)&&r.length){var o=t.apply(null,r);o&&l.push(o)}else if("object"===n)for(var i in r)e.call(r,i)&&r[i]&&l.push(i)}}return l.join(" ")}g.exports?(t.default=t,g.exports=t):window.classNames=t}();var y=h.exports;const N=({className:l,bootstrapStyle:a,children:r})=>e.count(r)>0?t("div",{className:y("alert alert-".concat(a),l)},r):null;function w(e,t){const[o,i]=a(),u=r((()=>{const t=null==e?void 0:e.getBoundingClientRect();var l,a;a=o,(l=t)&&a&&l.height===a.height&&l.width===a.width&&l.bottom===a.bottom&&l.top===a.top&&l.left===a.left&&l.right===a.right||i(t)}),[o,e]);return function(e){const t=n(),a=r((()=>{e(),t.current=window.requestAnimationFrame(a)}),[e]);l((()=>{if(e)return t.current=window.requestAnimationFrame(a),()=>{window.cancelAnimationFrame(t.current)}}),[e,a])}(t?u:void 0),o}function q(e){const[i,u]=a(e.defaultFilter),[s,c]=a(!1),d=n(null),m=n(null);var v,f;l((()=>{const e=e=>{if(Array.isArray(v)){if(v.some((t=>!t.current||t.current.contains(e.target))))return}else if(!v.current||v.current.contains(e.target))return;f()};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}}),[v=[d,m],f=()=>c(!1)]);const p=w(d.current,s),b=r((t=>{u(t),e.onChange(t),c(!1)}),[e.onChange]);l((()=>{u(e.defaultFilter),e.onChange(e.defaultFilter)}),[e.defaultFilter,e.onChange]);const g=o(t("ul",{ref:m,id:"".concat(e.name,"-filter-selectors"),className:"filter-selectors",role:"menu","data-focusindex":0,style:{position:"fixed",top:null==p?void 0:p.bottom,left:null==p?void 0:p.left}},e.options.map(((l,a)=>t("li",{className:y({"filter-selected":i===l.value}),key:a,onClick:e=>{e.preventDefault(),e.stopPropagation(),b(l.value)},onKeyDown:t=>{var r,n;"Enter"===t.key||" "===t.key?(t.preventDefault(),t.stopPropagation(),b(l.value)):"Tab"===t.key&&a+1===e.options.length?(t.preventDefault(),b(i)):("Tab"===t.key&&t.shiftKey&&0===a||"Escape"===t.key)&&(t.preventDefault(),null===(n=null===(r=d.current)||void 0===r?void 0:r.querySelector("button"))||void 0===n||n.focus(),c(!1))},role:"menuitem",tabIndex:0},t("div",{className:y("filter-icon",l.value),"aria-hidden":!0}),t("div",{className:"filter-label"},l.label))))),document.body),h=r((()=>{c((e=>!e)),setTimeout((()=>{var e,t;null===(t=null===(e=m.current)||void 0===e?void 0:e.querySelector("li.filter-selected"))||void 0===t||t.focus()}),10)}),[]);return t("div",{className:"filter-selector"},t("div",{className:"filter-selector-content",ref:d},t("button",{"aria-controls":"".concat(e.name,"-filter-selectors"),"aria-expanded":s,"aria-haspopup":!0,"aria-label":e.ariaLabel,className:y("btn btn-default filter-selector-button button-icon",i),onClick:h,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),h())}},"Â "),s&&g))}N.displayName="Alert";var C;function E(e){var o;const[u,s]=a(e.defaultFilter),[c,d]=a(void 0),[m,v]=a(void 0),f=n(null);l((()=>{e.value&&(v(e.value.toString()),d(e.value))}),[e.value]),l((()=>{var t;null===(t=e.updateFilters)||void 0===t||t.call(e,c,u)}),[c,u]);const p=r(((e,t)=>{let l=null;return(...a)=>{null!==l&&(clearTimeout(l),l=null),l=setTimeout((()=>e(...a)),t)}})((e=>d(e)),e.delay),[e.delay]),b=r((()=>{f.current&&f.current.focus()}),[f]);return t("div",{className:y("filter-container",e.className),"data-focusindex":null!==(o=e.tabIndex)&&void 0!==o?o:0,style:e.styles},e.adjustable&&t(q,{ariaLabel:e.screenReaderButtonCaption,name:e.name,defaultFilter:e.defaultFilter,onChange:r((e=>{s((t=>t===e?t:(b(),e)))}),[b]),options:[{value:"greater",label:"Greater than"},{value:"greaterEqual",label:"Greater than or equal"},{value:"equal",label:"Equal"},{value:"notEqual",label:"Not equal"},{value:"smaller",label:"Smaller than"},{value:"smallerEqual",label:"Smaller than or equal"}]}),t("input",{"aria-label":e.screenReaderInputCaption,className:y("form-control",{"filter-input":e.adjustable}),onChange:e=>{const t=e.target.value;t&&!isNaN(Number(t))?(v(t),p(new i(Number(t)))):(v(t),p(void 0))},placeholder:e.placeholder,ref:f,type:"number",value:m}))}function F(e){if(e&&1===e.length){const[t]=e;let l="equal";switch(t.type){case">":l="greater";break;case">=":l="greaterEqual";break;case"=":l="equal";break;case"!=":l="notEqual";break;case"<":l="smaller";break;case"<=":l="smallerEqual"}return{type:l,value:t.value}}}function k(e){const l=window["com.mendix.widgets.web.filterable.filterContext"],a=t(N,{bootstrapStyle:"danger"},"The Number filter widget must be placed inside the header of the Data grid 2.0 or Gallery widget."),r=t(N,{bootstrapStyle:"danger"},'The Number filter widget can\'t be used with the filters options you have selected. It requires a "Autonumber, Decimal, Integer or Long" attribute to be selected.');return(null==l?void 0:l.Consumer)?t(l.Consumer,null,(l=>{var n,o,i,s,c,d,m;if(!l||!l.filterDispatcher||!l.singleAttribute&&!l.multipleAttributes)return a;const{filterDispatcher:v,singleAttribute:f,multipleAttributes:p,singleInitialFilter:b,multipleInitialFilters:g}=l,h=[...f?[f]:[],...p&&null!==(n=x(p))&&void 0!==n?n:[]];if(0===h.length)return p?r:a;const y=F(b||(null==g?void 0:g[h[0].id])),w=(q=h[0].type)&&!q.match(/AutoNumber|Decimal|Integer|Long/)?"The attribute type being used for Number filter is not 'Autonumber, Decimal, Integer or Long'":null;var q;return w?t(N,{bootstrapStyle:"danger"},w):t(E,{adjustable:e.adjustable,className:e.class,defaultFilter:null!==(o=null==y?void 0:y.type)&&void 0!==o?o:e.defaultFilter,delay:e.delay,name:e.name,placeholder:null===(i=e.placeholder)||void 0===i?void 0:i.value,screenReaderButtonCaption:null===(s=e.screenReaderButtonCaption)||void 0===s?void 0:s.value,screenReaderInputCaption:null===(c=e.screenReaderInputCaption)||void 0===c?void 0:c.value,styles:e.style,tabIndex:e.tabIndex,updateFilters:(e,t)=>{const l=null==h?void 0:h.map((l=>A(l,e,t))).filter((e=>void 0!==e));v({getFilterCondition:()=>l&&l.length>1?u(...l):null==l?void 0:l[0],filterType:"number"})},value:null!==(d=null==y?void 0:y.value)&&void 0!==d?d:null===(m=e.defaultValue)||void 0===m?void 0:m.value})})):a}function x(e){if(e)return Object.keys(e).map((t=>e[t])).filter((e=>e.type.match(/AutoNumber|Decimal|Integer|Long/)))}function A(e,t,l){if(!e||!e.filterable||!t)return;return{greater:d,greaterEqual:m,equal:v,notEqual:f,smaller:p,smallerEqual:b}[l](s(e.id),c(t))}!function(e){e.Number="number",e.DateTime="datetime"}(C||(C={}));export{k as default};
