define(["react","react-dom","big.js","mendix/filters/builders"],(function(e,t,l,a){"use strict";var r,n={exports:{}};
/*!
    Copyright (c) 2017 Jed Watson.
    Licensed under the MIT License (MIT), see
    http://jedwatson.github.io/classnames
  */r=n,function(){var e={}.hasOwnProperty;function t(){for(var l=[],a=0;a<arguments.length;a++){var r=arguments[a];if(r){var n=typeof r;if("string"===n||"number"===n)l.push(r);else if(Array.isArray(r)&&r.length){var u=t.apply(null,r);u&&l.push(u)}else if("object"===n)for(var i in r)e.call(r,i)&&r[i]&&l.push(i)}}return l.join(" ")}r.exports?(t.default=t,r.exports=t):window.classNames=t}();var u=n.exports;const i=({className:t,bootstrapStyle:l,children:a})=>e.Children.count(a)>0?e.createElement("div",{className:u("alert alert-".concat(l),t)},a):null;function o(t,l){const[a,r]=e.useState(),n=e.useCallback((()=>{const e=null==t?void 0:t.getBoundingClientRect();var l,n;n=a,(l=e)&&n&&l.height===n.height&&l.width===n.width&&l.bottom===n.bottom&&l.top===n.top&&l.left===n.left&&l.right===n.right||r(e)}),[a,t]);return function(t){const l=e.useRef(),a=e.useCallback((()=>{t(),l.current=window.requestAnimationFrame(a)}),[t]);e.useEffect((()=>{if(t)return l.current=window.requestAnimationFrame(a),()=>{window.cancelAnimationFrame(l.current)}}),[t,a])}(l?n:void 0),a}function s(l){const[a,r]=e.useState(l.defaultFilter),[n,i]=e.useState(!1),s=e.useRef(null),c=e.useRef(null);var d,m;d=[s,c],m=()=>i(!1),e.useEffect((()=>{const e=e=>{if(Array.isArray(d)){if(d.some((t=>!t.current||t.current.contains(e.target))))return}else if(!d.current||d.current.contains(e.target))return;m()};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}}),[d,m]);const f=o(s.current,n),v=e.useCallback((e=>{r(e),l.onChange(e),i(!1)}),[l.onChange]);e.useEffect((()=>{r(l.defaultFilter),l.onChange(l.defaultFilter)}),[l.defaultFilter,l.onChange]);const b=t.createPortal(e.createElement("ul",{ref:c,id:"".concat(l.name,"-filter-selectors"),className:"filter-selectors",role:"menu","data-focusindex":0,style:{position:"fixed",top:null==f?void 0:f.bottom,left:null==f?void 0:f.left}},l.options.map(((t,r)=>e.createElement("li",{className:u({"filter-selected":a===t.value}),key:r,onClick:e=>{e.preventDefault(),e.stopPropagation(),v(t.value)},onKeyDown:e=>{var n,u;"Enter"===e.key||" "===e.key?(e.preventDefault(),e.stopPropagation(),v(t.value)):"Tab"===e.key&&r+1===l.options.length?(e.preventDefault(),v(a)):("Tab"===e.key&&e.shiftKey&&0===r||"Escape"===e.key)&&(e.preventDefault(),null===(u=null===(n=s.current)||void 0===n?void 0:n.querySelector("button"))||void 0===u||u.focus(),i(!1))},role:"menuitem",tabIndex:0},e.createElement("div",{className:u("filter-icon",t.value),"aria-hidden":!0}),e.createElement("div",{className:"filter-label"},t.label))))),document.body),p=e.useCallback((()=>{i((e=>!e)),setTimeout((()=>{var e,t;null===(t=null===(e=c.current)||void 0===e?void 0:e.querySelector("li.filter-selected"))||void 0===t||t.focus()}),10)}),[]);return e.createElement("div",{className:"filter-selector"},e.createElement("div",{className:"filter-selector-content",ref:s},e.createElement("button",{"aria-controls":"".concat(l.name,"-filter-selectors"),"aria-expanded":n,"aria-haspopup":!0,"aria-label":l.ariaLabel,className:u("btn btn-default filter-selector-button button-icon",a),onClick:p,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),p())}},"Â "),n&&b))}i.displayName="Alert";var c;function d(t){var a;const[r,n]=e.useState(t.defaultFilter),[i,o]=e.useState(void 0),[c,d]=e.useState(void 0),m=e.useRef(null);e.useEffect((()=>{t.value&&(d(t.value.toString()),o(t.value))}),[t.value]),e.useEffect((()=>{var e;null===(e=t.updateFilters)||void 0===e||e.call(t,i,r)}),[i,r]);const f=e.useCallback(((e,t)=>{let l=null;return(...a)=>{null!==l&&(clearTimeout(l),l=null),l=setTimeout((()=>e(...a)),t)}})((e=>o(e)),t.delay),[t.delay]),v=e.useCallback((()=>{m.current&&m.current.focus()}),[m]);return e.createElement("div",{className:u("filter-container",t.className),"data-focusindex":null!==(a=t.tabIndex)&&void 0!==a?a:0,style:t.styles},t.adjustable&&e.createElement(s,{ariaLabel:t.screenReaderButtonCaption,name:t.name,defaultFilter:t.defaultFilter,onChange:e.useCallback((e=>{n((t=>t===e?t:(v(),e)))}),[v]),options:[{value:"greater",label:"Greater than"},{value:"greaterEqual",label:"Greater than or equal"},{value:"equal",label:"Equal"},{value:"notEqual",label:"Not equal"},{value:"smaller",label:"Smaller than"},{value:"smallerEqual",label:"Smaller than or equal"}]}),e.createElement("input",{"aria-label":t.screenReaderInputCaption,className:u("form-control",{"filter-input":t.adjustable}),onChange:e=>{const t=e.target.value;t&&!isNaN(Number(t))?(d(t),f(new l.Big(Number(t)))):(d(t),f(void 0))},placeholder:t.placeholder,ref:m,type:"number",value:c}))}function m(e){if(e&&1===e.length){const[t]=e;let l="equal";switch(t.type){case">":l="greater";break;case">=":l="greaterEqual";break;case"=":l="equal";break;case"!=":l="notEqual";break;case"<":l="smaller";break;case"<=":l="smallerEqual"}return{type:l,value:t.value}}}function f(e){if(e)return Object.keys(e).map((t=>e[t])).filter((e=>e.type.match(/AutoNumber|Decimal|Integer|Long/)))}return function(e){e.Number="number",e.DateTime="datetime"}(c||(c={})),function(t){const l=window["com.mendix.widgets.web.filterable.filterContext"],r=e.createElement(i,{bootstrapStyle:"danger"},"The Number filter widget must be placed inside the header of the Data grid 2.0 or Gallery widget."),n=e.createElement(i,{bootstrapStyle:"danger"},'The Number filter widget can\'t be used with the filters options you have selected. It requires a "Autonumber, Decimal, Integer or Long" attribute to be selected.');return(null==l?void 0:l.Consumer)?e.createElement(l.Consumer,null,(l=>{var u,o,s,c,v,b,p;if(!l||!l.filterDispatcher||!l.singleAttribute&&!l.multipleAttributes)return r;const{filterDispatcher:g,singleAttribute:h,multipleAttributes:y,singleInitialFilter:E,multipleInitialFilters:C}=l,q=[...h?[h]:[],...y&&null!==(u=f(y))&&void 0!==u?u:[]];if(0===q.length)return y?n:r;const N=m(E||(null==C?void 0:C[q[0].id])),w=(k=q[0].type)&&!k.match(/AutoNumber|Decimal|Integer|Long/)?"The attribute type being used for Number filter is not 'Autonumber, Decimal, Integer or Long'":null;var k;return w?e.createElement(i,{bootstrapStyle:"danger"},w):e.createElement(d,{adjustable:t.adjustable,className:t.class,defaultFilter:null!==(o=null==N?void 0:N.type)&&void 0!==o?o:t.defaultFilter,delay:t.delay,name:t.name,placeholder:null===(s=t.placeholder)||void 0===s?void 0:s.value,screenReaderButtonCaption:null===(c=t.screenReaderButtonCaption)||void 0===c?void 0:c.value,screenReaderInputCaption:null===(v=t.screenReaderInputCaption)||void 0===v?void 0:v.value,styles:t.style,tabIndex:t.tabIndex,updateFilters:(e,t)=>{const l=null==q?void 0:q.map((l=>function(e,t,l){if(!e||!e.filterable||!t)return;return{greater:a.greaterThan,greaterEqual:a.greaterThanOrEqual,equal:a.equals,notEqual:a.notEqual,smaller:a.lessThan,smallerEqual:a.lessThanOrEqual}[l](a.attribute(e.id),a.literal(t))}(l,e,t))).filter((e=>void 0!==e));g({getFilterCondition:()=>l&&l.length>1?a.or(...l):null==l?void 0:l[0],filterType:"number"})},value:null!==(b=null==N?void 0:N.value)&&void 0!==b?b:null===(p=t.defaultValue)||void 0===p?void 0:p.value})})):r}}));
