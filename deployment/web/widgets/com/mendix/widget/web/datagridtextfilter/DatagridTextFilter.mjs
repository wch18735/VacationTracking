import{Children as e,createElement as t,useEffect as a,useState as l,useCallback as r,useRef as n}from"react";import{createPortal as i}from"react-dom";import{or as o,attribute as u,literal as s,contains as c,startsWith as d,endsWith as v,greaterThan as f,greaterThanOrEqual as m,equals as p,notEqual as b,lessThan as h,lessThanOrEqual as g}from"mendix/filters/builders";var y,w={exports:{}};
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/y=w,function(){var e={}.hasOwnProperty;function t(){for(var a=[],l=0;l<arguments.length;l++){var r=arguments[l];if(r){var n=typeof r;if("string"===n||"number"===n)a.push(r);else if(Array.isArray(r)&&r.length){var i=t.apply(null,r);i&&a.push(i)}else if("object"===n)for(var o in r)e.call(r,o)&&r[o]&&a.push(o)}}return a.join(" ")}y.exports?(t.default=t,y.exports=t):window.classNames=t}();var q=w.exports;const x=({className:a,bootstrapStyle:l,children:r})=>e.count(r)>0?t("div",{className:q("alert alert-".concat(l),a)},r):null;function C(e,t){const[i,o]=l(),u=r((()=>{const t=null==e?void 0:e.getBoundingClientRect();var a,l;l=i,(a=t)&&l&&a.height===l.height&&a.width===l.width&&a.bottom===l.bottom&&a.top===l.top&&a.left===l.left&&a.right===l.right||o(t)}),[i,e]);return function(e){const t=n(),l=r((()=>{e(),t.current=window.requestAnimationFrame(l)}),[e]);a((()=>{if(e)return t.current=window.requestAnimationFrame(l),()=>{window.cancelAnimationFrame(t.current)}}),[e,l])}(t?u:void 0),i}function k(e){const[o,u]=l(e.defaultFilter),[s,c]=l(!1),d=n(null),v=n(null);var f,m;a((()=>{const e=e=>{if(Array.isArray(f)){if(f.some((t=>!t.current||t.current.contains(e.target))))return}else if(!f.current||f.current.contains(e.target))return;m()};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}}),[f=[d,v],m=()=>c(!1)]);const p=C(d.current,s),b=r((t=>{u(t),e.onChange(t),c(!1)}),[e.onChange]);a((()=>{u(e.defaultFilter),e.onChange(e.defaultFilter)}),[e.defaultFilter,e.onChange]);const h=i(t("ul",{ref:v,id:"".concat(e.name,"-filter-selectors"),className:"filter-selectors",role:"menu","data-focusindex":0,style:{position:"fixed",top:null==p?void 0:p.bottom,left:null==p?void 0:p.left}},e.options.map(((a,l)=>t("li",{className:q({"filter-selected":o===a.value}),key:l,onClick:e=>{e.preventDefault(),e.stopPropagation(),b(a.value)},onKeyDown:t=>{var r,n;"Enter"===t.key||" "===t.key?(t.preventDefault(),t.stopPropagation(),b(a.value)):"Tab"===t.key&&l+1===e.options.length?(t.preventDefault(),b(o)):("Tab"===t.key&&t.shiftKey&&0===l||"Escape"===t.key)&&(t.preventDefault(),null===(n=null===(r=d.current)||void 0===r?void 0:r.querySelector("button"))||void 0===n||n.focus(),c(!1))},role:"menuitem",tabIndex:0},t("div",{className:q("filter-icon",a.value),"aria-hidden":!0}),t("div",{className:"filter-label"},a.label))))),document.body),g=r((()=>{c((e=>!e)),setTimeout((()=>{var e,t;null===(t=null===(e=v.current)||void 0===e?void 0:e.querySelector("li.filter-selected"))||void 0===t||t.focus()}),10)}),[]);return t("div",{className:"filter-selector"},t("div",{className:"filter-selector-content",ref:d},t("button",{"aria-controls":"".concat(e.name,"-filter-selectors"),"aria-expanded":s,"aria-haspopup":!0,"aria-label":e.ariaLabel,className:q("btn btn-default filter-selector-button button-icon",o),onClick:g,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),g())}},"Â "),s&&h))}x.displayName="Alert";var E;function F(e){var i;const[o,u]=l(e.defaultFilter),[s,c]=l(""),[d,v]=l(""),f=n(null);a((()=>{e.value&&(v(e.value),c(e.value))}),[e.value]),a((()=>{var t;null===(t=e.updateFilters)||void 0===t||t.call(e,s,o)}),[s,o]);const m=r(((e,t)=>{let a=null;return(...l)=>{null!==a&&(clearTimeout(a),a=null),a=setTimeout((()=>e(...l)),t)}})((e=>c(e)),e.delay),[e.delay]),p=r((()=>{f.current&&f.current.focus()}),[f]);return t("div",{className:q("filter-container",e.className),"data-focusindex":null!==(i=e.tabIndex)&&void 0!==i?i:0,style:e.styles},e.adjustable&&t(k,{ariaLabel:e.screenReaderButtonCaption,name:e.name,defaultFilter:e.defaultFilter,onChange:r((e=>{u((t=>t===e?t:(p(),e)))}),[p]),options:[{value:"contains",label:"Contains"},{value:"startsWith",label:"Starts with"},{value:"endsWith",label:"Ends with"},{value:"greater",label:"Greater than"},{value:"greaterEqual",label:"Greater than or equal"},{value:"equal",label:"Equal"},{value:"notEqual",label:"Not equal"},{value:"smaller",label:"Smaller than"},{value:"smallerEqual",label:"Smaller than or equal"}]}),t("input",{"aria-label":e.screenReaderInputCaption,className:q("form-control",{"filter-input":e.adjustable}),onChange:e=>{v(e.target.value),m(e.target.value)},placeholder:e.placeholder,ref:f,type:"text",value:d}))}function N(e){if(e&&1===e.length){const[t]=e;let a="equal";switch(t.type){case"contains":a="contains";break;case"starts-with":a="startsWith";break;case"ends-with":a="endsWith";break;case">":a="greater";break;case">=":a="greaterEqual";break;case"=":a="equal";break;case"!=":a="notEqual";break;case"<":a="smaller";break;case"<=":a="smallerEqual"}return{type:a,value:String(t.value)}}}function S(e){const a=window["com.mendix.widgets.web.filterable.filterContext"],l=t(x,{bootstrapStyle:"danger"},"The Text filter widget must be placed inside the header of the Data grid 2.0 or Gallery widget."),r=t(x,{bootstrapStyle:"danger"},'The Text filter widget can\'t be used with the filters options you have selected. It requires a "Hashed string or String" attribute to be selected.');return(null==a?void 0:a.Consumer)?t(a.Consumer,null,(a=>{var n,i,u,s,c,d,v;if(!a||!a.filterDispatcher||!a.singleAttribute&&!a.multipleAttributes)return l;const{filterDispatcher:f,singleAttribute:m,multipleAttributes:p,singleInitialFilter:b,multipleInitialFilters:h}=a,g=[...m?[m]:[],...p&&null!==(n=T(p))&&void 0!==n?n:[]];if(0===g.length)return p?r:l;const y=N(b||(null==h?void 0:h[g[0].id])),w=(q=g[0].type)&&!q.match(/HashString|String/)?"The attribute type being used for Text filter is not 'Hashed string or String'":null;var q;return w?t(x,{bootstrapStyle:"danger"},w):t(F,{adjustable:e.adjustable,className:e.class,defaultFilter:null!==(i=null==y?void 0:y.type)&&void 0!==i?i:e.defaultFilter,delay:e.delay,name:e.name,placeholder:null===(u=e.placeholder)||void 0===u?void 0:u.value,screenReaderButtonCaption:null===(s=e.screenReaderButtonCaption)||void 0===s?void 0:s.value,screenReaderInputCaption:null===(c=e.screenReaderInputCaption)||void 0===c?void 0:c.value,styles:e.style,tabIndex:e.tabIndex,updateFilters:(e,t)=>{const a=null==g?void 0:g.map((a=>A(a,e,t))).filter((e=>void 0!==e));f({getFilterCondition:()=>a&&a.length>1?o(...a):null==a?void 0:a[0],filterType:"string"})},value:null!==(d=null==y?void 0:y.value)&&void 0!==d?d:null===(v=e.defaultValue)||void 0===v?void 0:v.value})})):l}function T(e){if(e)return Object.keys(e).map((t=>e[t])).filter((e=>e.type.match(/HashString|String/)))}function A(e,t,a){if(!e||!e.filterable||!t)return;return{contains:c,startsWith:d,endsWith:v,greater:f,greaterEqual:m,equal:p,notEqual:b,smaller:h,smallerEqual:g}[a](u(e.id),s(t))}!function(e){e.Number="number",e.DateTime="datetime"}(E||(E={}));export{S as default};
