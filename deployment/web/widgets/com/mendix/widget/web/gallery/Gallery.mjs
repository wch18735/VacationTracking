import{useState as e,createContext as t,useRef as a,useCallback as i,useLayoutEffect as n,createElement as r,useEffect as o,useMemo as s}from"react";import"react-dom";import{and as l}from"mendix/filters/builders";var c,d={exports:{}};
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/c=d,function(){var e={}.hasOwnProperty;function t(){for(var a=[],i=0;i<arguments.length;i++){var n=arguments[i];if(n){var r=typeof n;if("string"===r||"number"===r)a.push(n);else if(Array.isArray(n)&&n.length){var o=t.apply(null,n);o&&a.push(o)}else if("object"===r)for(var s in n)e.call(n,s)&&n[s]&&a.push(s)}}return a.join(" ")}c.exports?(t.default=t,c.exports=t):window.classNames=t}();var g=d.exports;function u(){const e=window["com.mendix.widgets.web.filterable.filterContext"];if(e)return{FilterContext:e};const a=t(void 0);return window["com.mendix.widgets.web.filterable.filterContext"]=a,{FilterContext:a}}function m(){const e=window["com.mendix.widgets.web.sortable.sortContext"];if(e)return{SortContext:e};const a=t(void 0);return window["com.mendix.widgets.web.sortable.sortContext"]=a,{SortContext:a}}function p(t){const[o,s]=e(0),l=a(null),c=i((e=>{Math.floor(e.target.scrollHeight-e.target.scrollTop)===Math.floor(e.target.clientHeight)&&t.hasMoreItems&&t.setPage&&t.setPage((e=>e+1))}),[t.hasMoreItems,t.setPage]),d=i((()=>{t.isInfinite&&t.hasMoreItems&&o<=0&&l.current&&s(l.current.clientHeight-30)}),[t.isInfinite,t.hasMoreItems,o]);return n((()=>{setTimeout((()=>d()),100)}),[d]),r("div",Object.assign({ref:l},t,{className:g(t.className,t.isInfinite?"infinite-loading":""),onScroll:t.isInfinite?c:void 0,style:t.isInfinite&&o>0?Object.assign(Object.assign({},t.style),{maxHeight:o}):t.style}),t.children)}function f(e){var t,a,i,n,o,s,l;const c=void 0!==e.numberOfItems?Math.ceil(e.numberOfItems/e.pageSize):void 0,d=void 0!==c?c-1:0,g=void 0!==c,u=e.page*e.pageSize+1,m=e.canNextPage||!e.numberOfItems?(e.page+1)*e.pageSize:e.numberOfItems,p=t=>{e.setPaginationIndex&&e.setPaginationIndex(t)};if(0===e.numberOfItems)return null;const f="".concat(u," to ").concat(m," ").concat(g?"of ".concat(null!==(t=e.numberOfItems)&&void 0!==t?t:(null!=c?c:1)*e.pageSize):"");return r("div",{"aria-label":null!==(a=e.labelPagination)&&void 0!==a?a:"Pagination",className:"pagination-bar",role:"pagination"},r("button",Object.assign({className:"btn pagination-button",disabled:0===e.page},v((()=>{e.gotoPage(0),p(0)})),{"aria-label":null!==(i=e.labelFirstPage)&&void 0!==i?i:"Go to first page"}),r("span",{"aria-hidden":!0,className:"glyphicon glyphicon-step-backward"})),r("button",Object.assign({className:"btn pagination-button",disabled:!e.canPreviousPage},v((()=>{e.previousPage(),p(e.page-1)})),{"aria-label":null!==(n=e.labelPreviousPage)&&void 0!==n?n:"Go to previous page"}),r("span",{"aria-hidden":!0,className:"glyphicon glyphicon-backward"})),r("span",{className:"sr-only sr-only-focusable"},null!==(o=e.labelPagingStatus)&&void 0!==o?o:"Currently showing"," ",f),r("div",{"aria-hidden":!0,className:"paging-status"},f),r("button",Object.assign({"aria-label":null!==(s=e.labelNextPage)&&void 0!==s?s:"Go to next page",className:"btn pagination-button",disabled:!e.canNextPage},v((()=>{e.nextPage(),p(e.page+1)}))),r("span",{"aria-hidden":!0,className:"glyphicon glyphicon-forward"})),g&&r("button",Object.assign({"aria-label":null!==(l=e.labelLastPage)&&void 0!==l?l:"Go to last page",className:"btn pagination-button",disabled:e.page===d},v((()=>{e.gotoPage(d),p(d)}))),r("span",{"aria-hidden":!0,className:"glyphicon glyphicon-step-forward"})))}function v(e){return{onClick:e,onKeyDown:t=>{" "!==t.key&&"Enter"!==t.key||(t.preventDefault(),t.stopPropagation(),e())}}}function b(e){const t=e.paging?r("div",{className:"widget-gallery-pagination"},r(f,{canNextPage:e.hasMoreItems,canPreviousPage:0!==e.page,gotoPage:t=>e.setPage&&e.setPage((()=>t)),nextPage:()=>e.setPage&&e.setPage((e=>e+1)),numberOfItems:e.numberOfItems,page:e.page,pageSize:e.pageSize,previousPage:()=>e.setPage&&e.setPage((e=>e-1))})):null;return r("div",{className:g("widget-gallery",e.className),"data-focusindex":e.tabIndex||0},"above"===e.paginationPosition&&t,r("div",{className:"widget-gallery-filter",role:"section","aria-label":e.filtersTitle},e.filters),e.items.length>0&&e.itemRenderer&&r(p,{className:g("widget-gallery-items","widget-gallery-lg-".concat(e.desktopItems),"widget-gallery-md-".concat(e.tabletItems),"widget-gallery-sm-".concat(e.phoneItems)),hasMoreItems:e.hasMoreItems,setPage:e.setPage,isInfinite:!e.paging,role:"list"},e.items.map((t=>e.itemRenderer(((e,a,i)=>r("div",{key:"item_".concat(t),className:g("widget-gallery-item",a,{"widget-gallery-clickable":!!i}),onClick:i,onKeyDown:i?e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),i())}:void 0,role:i?"button":"listitem",tabIndex:i?0:void 0},e)),t)))),(0===e.items.length||e.preview)&&e.emptyPlaceholderRenderer&&e.emptyPlaceholderRenderer((t=>r("div",{className:"widget-gallery-empty",role:"section","aria-label":e.emptyMessageTitle},r("div",{className:"empty-placeholder"},t)))),"below"===e.paginationPosition&&t)}function h(e,t){if(!e||!t)return[];const a=y(t);return a?a.filter((e=>!!e.arg1&&!!e.arg2)).filter((t=>"attribute"===t.arg1.type&&t.arg1.attributeId===e.id)).map((e=>({type:String(e.name),value:e.arg2.value}))):[]}function y(e){return!e||"function"!==e.type||"and"!==e.name&&"or"!==e.name?e?[e]:void 0:e.args.flatMap(y).filter((e=>void 0!==e))}function P(t){var n,c,d,g;const p=a(void 0),f=a(void 0),[v,y]=e(!1),[P,I]=e(!1),w={string:e(),number:e(),date:e(),enum:e()},[x,N]=e(),{FilterContext:S}=u(),{SortContext:O}=m(),C="virtualScrolling"===t.pagination,k=C?t.datasource.limit/t.pageSize:t.datasource.offset/t.pageSize;o((()=>{t.datasource.requestTotalCount(!0),t.datasource.limit===Number.POSITIVE_INFINITY&&t.datasource.setLimit(t.pageSize)}),[t.datasource,t.pageSize]),o((()=>{!t.datasource.filter||v||p.current||(p.current=t.datasource.filter),!t.datasource.sortOrder||P||f.current||(f.current=t.datasource.sortOrder)}),[t.datasource,v,P]);const M=s((()=>t.filterList.reduce(((e,{filter:t})=>({...e,[t.id]:t})),{})),[t.filterList]),z=s((()=>t.sortList.map((({attribute:e,caption:t})=>{var a;return{attribute:e,caption:null!==(a=t.value)&&void 0!==a?a:""}}))),[t.sortList]),T=s((()=>t.filterList.reduce(((e,{filter:t})=>({...e,[t.id]:h(t,p.current)})),{})),[t.filterList,p.current]),L=Object.keys(w).map((e=>{var t;return null===(t=w[e][0])||void 0===t?void 0:t.getFilterCondition()})).filter((e=>void 0!==e));if(L.length>0?t.datasource.setFilter(L.length>1?l(...L):L[0]):v?t.datasource.setFilter(void 0):t.datasource.setFilter(p.current),x&&"getSortCondition"in x){const e=x.getSortCondition();t.datasource.setSortOrder(e?[e]:void 0)}else t.datasource.setSortOrder(void 0);const j=t.filterList.length>0||t.sortList.length>0,F=i((e=>{const a=e(k);C?t.datasource.setLimit(a*t.pageSize):t.datasource.setOffset(a*t.pageSize)}),[t.datasource,t.pageSize,C,k]);return r(b,{className:t.class,desktopItems:t.desktopItems,emptyPlaceholderRenderer:i((e=>"custom"===t.showEmptyPlaceholder?e(t.emptyPlaceholder):r("div",null)),[t.emptyPlaceholder,t.showEmptyPlaceholder]),emptyMessageTitle:null===(n=t.emptyMessageTitle)||void 0===n?void 0:n.value,filters:s((()=>j?r(S.Provider,{value:{filterDispatcher:e=>{if(e.filterType){const[,t]=w[e.filterType];t(e),y(!0)}return e},multipleAttributes:M,multipleInitialFilters:T}},r(O.Provider,{value:{sortDispatcher:e=>(I(!0),N(e),e),attributes:z,initialSort:f.current}},t.filtersPlaceholder)):null),[S,O,w,M,T,j,t.filtersPlaceholder,z]),filtersTitle:null===(c=t.filterSectionTitle)||void 0===c?void 0:c.value,hasMoreItems:null!==(d=t.datasource.hasMoreItems)&&void 0!==d&&d,items:null!==(g=t.datasource.items)&&void 0!==g?g:[],itemRenderer:i(((e,a)=>{var i,n,r,o;return e(null===(i=t.content)||void 0===i?void 0:i.get(a),null===(r=null===(n=t.itemClass)||void 0===n?void 0:n.get(a))||void 0===r?void 0:r.value,t.onClick?null===(o=t.onClick)||void 0===o?void 0:o.get(a).execute:void 0)}),[t.content,t.itemClass,t.onClick]),numberOfItems:t.datasource.totalCount,page:k,pageSize:t.pageSize,paging:"buttons"===t.pagination,paginationPosition:t.pagingPosition,phoneItems:t.phoneItems,setPage:F,tabletItems:t.tabletItems,tabIndex:t.tabIndex})}export{P as Gallery};
